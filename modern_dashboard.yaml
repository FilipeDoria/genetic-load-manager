# Modern Genetic Load Manager Dashboard
# Uses ONLY standard Home Assistant components - no custom cards required
# Copy this to your Lovelace dashboards

title: "üß¨ Genetic Load Manager"
path: genetic-load-manager
icon: mdi:dna
panel: false
cards:

# ==================================================
# HEADER STATUS BAR
# ==================================================
- type: horizontal-stack
  cards:
    - type: entity
      entity: sensor.genetic_load_manager_dashboard
      name: "System Health"
      icon: mdi:heart-pulse
      state_color: true
      secondary_info: name
    
    - type: entity
      entity: sensor.genetic_load_manager_indexed_pricing
      name: "Current Price"
      icon: mdi:currency-eur
      state_color: true
      secondary_info: name
    
    - type: entity
      entity: sensor.cost_analytics
      name: "Today's Savings"
      icon: mdi:piggy-bank
      state_color: true
      secondary_info: name
    
    - type: entity
      entity: sensor.genetic_algorithm_status
      name: "Status"
      icon: mdi:dna
      state_color: true
      secondary_info: name

# ==================================================
# MAIN DASHBOARD GRID
# ==================================================
- type: grid
  columns: 2
  square: false
  cards:
    
    # OPTIMIZATION PROGRESS CARD
    - type: vertical-stack
      cards:
        - type: markdown
          content: |
            ## üöÄ Optimization Progress
        
        - type: gauge
          entity: sensor.genetic_load_manager_dashboard
          name: "System Health"
          min: 0
          max: 100
          needle: true
          severity:
            green: 80
            yellow: 60
            red: 0
        
        - type: entities
          show_header_toggle: false
          entities:
            - type: attribute
              entity: sensor.genetic_load_manager_dashboard
              attribute: quick_stats.next_optimization
              name: "Next Optimization"
              icon: mdi:clock-outline
            
            - type: attribute
              entity: sensor.genetic_load_manager_dashboard
              attribute: quick_stats.active_optimizations
              name: "Active Optimizations"
              icon: mdi:cog-play

    # DEVICE CONTROL CARD
    - type: vertical-stack
      cards:
        - type: markdown
          content: |
            ## üéõÔ∏è Device Control
        
        - type: grid
          columns: 2
          square: true
          cards:
            - type: entity
              entity: switch.device_0_schedule
              name: "Device 0"
              icon: mdi:power-plug
              state_color: true
            
            - type: entity
              entity: switch.device_1_schedule
              name: "Device 1"
              icon: mdi:power-plug
              state_color: true
        
        - type: horizontal-stack
          cards:
            - type: call-service
              name: "üöÄ Optimize"
              icon: mdi:play-circle
              service: genetic_load_manager.run_optimization
            
            - type: call-service
              name: "‚è∏Ô∏è Stop"
              icon: mdi:stop-circle
              service: genetic_load_manager.stop_optimization

# ==================================================
# PRICING & COST ANALYSIS
# ==================================================
- type: horizontal-stack
  cards:
    
    # PRICING INFORMATION
    - type: entities
      title: "‚ö° Current Electricity Pricing"
      show_header_toggle: false
      entities:
        - entity: sensor.genetic_load_manager_indexed_pricing
          name: "Current Price"
          icon: mdi:currency-eur
        
        - type: attribute
          entity: sensor.genetic_load_manager_indexed_pricing
          attribute: pricing_components.market_price
          name: "Market Price (OMIE)"
          icon: mdi:chart-line
          unit: "‚Ç¨/MWh"
        
        - type: attribute
          entity: sensor.genetic_load_manager_indexed_pricing
          attribute: pricing_components.final_price
          name: "Final Price"
          icon: mdi:calculator
          unit: "‚Ç¨/kWh"

    # COST SAVINGS
    - type: entities
      title: "üí∞ Cost Savings"
      show_header_toggle: false
      entities:
        - type: attribute
          entity: sensor.cost_analytics
          attribute: financial_summary.daily_savings
          name: "Daily Savings"
          icon: mdi:cash-plus
          unit: "‚Ç¨"
        
        - type: attribute
          entity: sensor.cost_analytics
          attribute: financial_summary.weekly_savings
          name: "Weekly Savings"
          icon: mdi:cash-multiple
          unit: "‚Ç¨"
        
        - type: attribute
          entity: sensor.cost_analytics
          attribute: financial_summary.monthly_projection
          name: "Monthly Projection"
          icon: mdi:piggy-bank-outline
          unit: "‚Ç¨"

# ==================================================
# SCHEDULE VISUALIZATION
# ==================================================
- type: vertical-stack
  cards:
    - type: markdown
      content: |
        ## üìÖ Schedule & Timeline
    
    # CURRENT SCHEDULE STATUS
    - type: entities
      title: "üîÑ Current Schedule Status"
      show_header_toggle: false
      entities:
        - entity: switch.device_0_schedule
          name: "Device 0"
          icon: mdi:power-plug
        
        - entity: switch.device_1_schedule
          name: "Device 1"
          icon: mdi:power-plug
        
        - type: attribute
          entity: sensor.genetic_load_manager_dashboard
          attribute: dashboard_data.current_status
          name: "Optimization Status"
          icon: mdi:cog

    # SCHEDULE PREVIEW
    - type: markdown
      title: "‚è∞ Schedule Preview (Next 8 Hours)"
      content: |
        {% set preview = state_attr('sensor.genetic_load_manager_dashboard', 'dashboard_data')['schedule_preview'] %}
        {% if preview %}
        | Time | Price | Device 0 | Device 1 | Solar | Load |
        |------|-------|----------|----------|-------|------|
        {% for slot in preview %}
        | {{ slot.time }} | ‚Ç¨{{ "%.4f"|format(slot.price) }} | {{ slot.devices.device_0 }} | {{ slot.devices.device_1 }} | {{ slot.solar_forecast }} kW | {{ slot.load_forecast }} kW |
        {% endfor %}
        {% else %}
        *No schedule data available yet*
        {% endif %}

# ==================================================
# SYSTEM INFORMATION PANEL
# ==================================================
- type: entities
  title: "‚ÑπÔ∏è System Information"
  show_header_toggle: false
  entities:
    - entity: binary_sensor.genetic_load_manager_optimization_running
      name: "Optimization Running"
      icon: mdi:play-circle
    
    - entity: binary_sensor.genetic_load_manager_system_healthy
      name: "System Healthy"
      icon: mdi:heart-pulse
    
    - entity: binary_sensor.genetic_load_manager_loads_controlled
      name: "Loads Controlled"
      icon: mdi:lightning-bolt
    
    - entity: binary_sensor.genetic_load_manager_algorithm_error
      name: "Algorithm Errors"
      icon: mdi:alert-circle
    
    - type: divider
    
    - type: attribute
      entity: sensor.genetic_load_manager_dashboard
      attribute: quick_stats.solar_production_today
      name: "Solar Production Today"
      icon: mdi:solar-power
    
    - type: attribute
      entity: sensor.genetic_load_manager_dashboard
      attribute: quick_stats.grid_import_today
      name: "Grid Import Today"
      icon: mdi:transmission-tower
    
    - type: attribute
      entity: sensor.genetic_load_manager_dashboard
      attribute: quick_stats.battery_cycles_today
      name: "Battery Cycles Today"
      icon: mdi:battery-charging

# ==================================================
# CONTROL PANEL
# ==================================================
- type: vertical-stack
  cards:
    - type: markdown
      content: |
        ## üéõÔ∏è Advanced Controls
    
    - type: grid
      columns: 2
      square: false
      cards:
        - type: call-service
          name: "Quick Optimize"
          icon: mdi:flash
          service: genetic_load_manager.run_optimization
          service_data:
            population_size: 50
            generations: 100
        
        - type: call-service
          name: "Toggle Mode"
          icon: mdi:swap-horizontal
          service: genetic_load_manager.toggle_scheduler
          service_data:
            mode: "rule-based"
        
        - type: call-service
          name: "Update Pricing"
          icon: mdi:currency-eur
          service: genetic_load_manager.update_pricing_parameters
        
        - type: call-service
          name: "Export Data"
          icon: mdi:download
          service: genetic_load_manager.export_schedule
          service_data:
            format: "json"

# ==================================================
# EFFICIENCY MONITORING
# ==================================================
- type: vertical-stack
  cards:
    - type: markdown
      content: |
        ## ‚ö° Efficiency Monitoring
    
    # EFFICIENCY METRICS
    - type: horizontal-stack
      cards:
        - type: entity
          entity: sensor.genetic_load_manager_dashboard
          attribute: dashboard_data.efficiency_metrics.solar_utilization
          name: "Solar Utilization"
          icon: mdi:solar-power
          unit: "%"
        
        - type: entity
          entity: sensor.genetic_load_manager_dashboard
          attribute: dashboard_data.efficiency_metrics.load_optimization
          name: "Load Optimization"
          icon: mdi:speedometer
          unit: "%"
        
        - type: entity
          entity: sensor.load_forecast
          name: "Load Forecast"
          icon: mdi:chart-line
          unit: "kWh"

    # PERFORMANCE TRENDS
    - type: markdown
      title: "üìà Performance Trends (Last 24 Hours)"
      content: |
        {% set trends = state_attr('sensor.genetic_load_manager_dashboard', 'dashboard_data')['performance_trends'] %}
        {% if trends %}
        **Latest Performance Data:**
        {% for trend in trends[-5:] %}
        - **{{ trend.time }}**: Health {{ trend.health }}%, Savings ‚Ç¨{{ "%.2f"|format(trend.savings) }}
        {% endfor %}
        {% else %}
        *No trend data available yet*
        {% endif %}

# ==================================================
# MOBILE-FRIENDLY COMPACT VIEW
# ==================================================
- type: conditional
  conditions:
    - condition: screen
      media_query: "(max-width: 768px)"
  card:
    type: vertical-stack
    title: "üì± Mobile View"
    cards:
      - type: glance
        title: "Quick Status"
        entities:
          - entity: sensor.genetic_load_manager_dashboard
            name: "Health"
          - entity: sensor.genetic_load_manager_indexed_pricing
            name: "Price"
          - entity: sensor.genetic_algorithm_status
            name: "Status"
      
      - type: horizontal-stack
        cards:
          - type: entity
            entity: switch.device_0_schedule
            name: "D0"
            tap_action:
              action: toggle
          
          - type: entity
            entity: switch.device_1_schedule
            name: "D1"
            tap_action:
              action: toggle
          
          - type: call-service
            name: "‚ö°"
            service: genetic_load_manager.run_optimization
